<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>React Trie 자동완성 (단일 파일)</title>

    <!-- 1. Tailwind CSS CDN: 스타일링을 위해 추가합니다. -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- 2. React 라이브러리 CDN: React와 ReactDOM을 불러옵니다. -->
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>

    <!-- 3. Babel CDN: JSX 문법을 브라우저가 이해할 수 있는 JavaScript로 변환합니다. -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
</head>
<body>
    <!-- React 앱이 렌더링될 DOM 컨테이너입니다. -->
    <div id="root"></div>

    <!-- 4. React 컴포넌트 및 로직 -->
    <!-- type을 "text/babel"로 설정하여 Babel이 이 스크립트 태그를 변환하도록 합니다. -->
    <script type="text/babel">
        // React에서 필요한 Hooks를 가져옵니다.
        const { useState, useEffect, useMemo, useCallback } = React;

        // ====================================================================
        // 1. 코퍼스 (검색 대상이 되는 데이터 샘플)
        // ====================================================================
        const CORPUS = [
          "react", "redux", "router", "recoil", "remix", "relay", "render",
          "javascript", "java", "json", "jquery", "jest", "jwt",
          "typescript", "tailwind", "testing", "trie", "try", "catch", "throw",
          "algorithm", "array", "api", "async", "await", "arrow function",
          "component", "context", "custom hook", "css", "closure", "callback", "class",
          "state", "props", "performance", "prefix", "promise", "prototype",
          "node", "next", "npm", "npx",
          "webpack", "babel", "backend", "browser", "build",
          "frontend", "function", "filter", "map", "reduce",
          "html", "http", "https", "header", "hook",
          // ... 등등 2000개의 단어가 있다고 가정합니다.
        ];

        // ====================================================================
        // 2. Trie 자료구조 구현
        // ====================================================================
        class TrieNode {
          constructor() {
            this.children = new Map();
            this.isEnd = false;
            this.word = null;
          }
        }

        class Trie {
          constructor() {
            this.root = new TrieNode();
          }

          insert(word) {
            let curr = this.root;
            const lowerCaseWord = word.toLowerCase();
            for (const char of lowerCaseWord) {
              if (!curr.children.has(char)) {
                curr.children.set(char, new TrieNode());
              }
              curr = curr.children.get(char);
            }
            curr.isEnd = true;
            curr.word = word;
          }

          _findAllWords(node, results) {
            if (results.length >= 10) return;
            if (node.isEnd) {
              results.push(node.word);
            }
            const sortedKeys = Array.from(node.children.keys()).sort();
            for (const char of sortedKeys) {
              this._findAllWords(node.children.get(char), results);
            }
          }

          getSuggestions(prefix) {
            const lowerCasePrefix = prefix.toLowerCase();
            let curr = this.root;
            for (const char of lowerCasePrefix) {
              if (!curr.children.has(char)) {
                return [];
              }
              curr = curr.children.get(char);
            }
            const results = [];
            this._findAllWords(curr, results);
            return results;
          }
        }

        // ====================================================================
        // 3. 디바운스(Debounce) 커스텀 훅
        // ====================================================================
        function useDebounce(value, delay) {
          const [debouncedValue, setDebouncedValue] = useState(value);
          useEffect(() => {
            const handler = setTimeout(() => {
              setDebouncedValue(value);
            }, delay);
            return () => {
              clearTimeout(handler);
            };
          }, [value, delay]);
          return debouncedValue;
        }

        // ====================================================================
        // 4. 메인 자동완성 컴포넌트
        // ====================================================================
        function App() {
          const [inputValue, setInputValue] = useState('');
          const [suggestions, setSuggestions] = useState([]);
          const [searchHistory, setSearchHistory] = useState([]);
          const DEBOUNCE_DELAY = 200;

          const trie = useMemo(() => {
            console.log("Trie 인스턴스를 생성합니다...");
            const trieInstance = new Trie();
            for (const word of CORPUS) {
              trieInstance.insert(word);
            }
            return trieInstance;
          }, []);

          const debouncedSearchTerm = useDebounce(inputValue, DEBOUNCE_DELAY);

          useEffect(() => {
            const trimmedTerm = debouncedSearchTerm.trim();
            if (trimmedTerm) {
              const searchResults = trie.getSuggestions(trimmedTerm);
              setSuggestions(searchResults);
            } else {
              setSuggestions([]);
            }
          }, [debouncedSearchTerm, trie]);

          const handleChange = useCallback((e) => {
            setInputValue(e.target.value);
          }, []);

          const handleSuggestionClick = useCallback((suggestion) => {
            setInputValue(suggestion);
            setSuggestions([]);
            setSearchHistory(prevHistory => {
              const newHistory = [suggestion, ...prevHistory.filter(item => item !== suggestion)];
              return newHistory.slice(0, 10);
            });
          }, []);

          const displayList = inputValue.trim() === '' ? searchHistory : suggestions;
          const listTitle = inputValue.trim() === '' ? '최근 검색어' : '추천 검색어';

          return (
            <div className="bg-gray-100 min-h-screen flex items-center justify-center font-sans">
              <div className="w-full max-w-md mx-auto p-4">
                <div className="bg-white rounded-xl shadow-lg p-6">
                  <img src="https://static.oliveyoung.co.kr/pc-static-root/image/comm/h1_logo.png" alt="Olive Young Logo" className="w-32 mx-auto mb-6" />
                  <h1 className="text-2xl font-bold text-gray-800 mb-6 text-center sr-only">상품 검색</h1>
                  <div className="relative">
                    <input
                      type="text"
                      value={inputValue}
                      onChange={handleChange}
                      placeholder="상품명을 입력하세요..."
                      className="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500 transition duration-200"
                    />
                  </div>
                  {displayList.length > 0 && (
                    <div className="mt-2 border border-gray-200 rounded-lg bg-white shadow-sm overflow-hidden">
                      <h3 className="text-sm font-semibold text-gray-600 px-4 py-2 bg-gray-50 border-b">{listTitle}</h3>
                      <ul className="divide-y divide-gray-100">
                        {displayList.map((item, index) => (
                          <li
                            key={`${item}-${index}`}
                            onClick={() => handleSuggestionClick(item)}
                            className="px-4 py-2 cursor-pointer hover:bg-green-50 transition duration-150"
                          >
                            {item}
                          </li>
                        ))}
                      </ul>
                    </div>
                  )}
                  {inputValue.trim() !== '' && suggestions.length === 0 && (
                    <div className="mt-2 text-center text-gray-500 text-sm py-4">
                      추천 검색어가 없습니다.
                    </div>
                  )}
                </div>
                <footer className="text-center text-xs text-gray-400 mt-6">
                  <p>&copy; OLIVE YOUNG</p>
                </footer>
              </div>
            </div>
          );
        }

        // ====================================================================
        // 5. React 앱을 HTML에 렌더링
        // ====================================================================
        const container = document.getElementById('root');
        const root = ReactDOM.createRoot(container);
        root.render(<App />);
    </script>
</body>
</html>

